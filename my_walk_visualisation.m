L = 1;
gamma = 0.009;

%углы из программы на Python относительно ног
Tetta_angl = [0.22761944901923448, 0.22720212940921533, 0.22595169903684942, 0.22387261254065338, 0.22097232330165345, 0.21726130106091188, 0.21275304558480593, 0.20746456993917078, 0.2014151700512318, 0.19462636664971983, 0.18712225543152383, 0.17892950706169047, 0.1700773671734246, 0.1605976563680887, 0.1505247702152033, 0.13989567925244695, 0.12874992898565607, 0.11712963988882494, 0.1050795074041057, 0.09264242743293162, 0.07986155663773858, 0.06678581944490554, -0.38469908169872413, -0.3842787333354583, -0.3830185639498363, -0.38092117816603077, -0.37799093069829964, -0.3742339296162862, -0.36965849283788094, -0.364274736184783, -0.3580935110315904, -0.35112735015279, -0.34339048285185514, -0.33489883496124584, -0.3256700288424083, -0.3157233833857754, -0.30507991401076634, -0.2937623326657865, -0.2817950478282284, -0.2692041645044701, -0.2560174842298771, -0.2422645050688005, -0.22797637847567137, -0.2131818859932249, -0.19791243456097207, -0.18220273631269007, -0.16608805504463628, -0.14960420621554782, -0.13278755694664088, -0.11567502602161125, 0.5417787143782138, 0.5414810111790134, 0.5405881970291028, 0.5391011524116169, 0.5370213489938093, 0.5343508506688361, 0.5310924269120246, 0.5272500288917272, 0.5228273480199598, 0.5178285145232836, 0.5122582800540983, 0.506122017690643, 0.49942572193699597, 0.492176008723074, 0.48438011540463366, 0.4760459007632698, 0.46718184500641713, 0.45779704976734864, 0.4479012381051771, 0.4375047545048538, 0.4266185648771691, 0.4152542565587529, 0.40342403831207346, 0.391140740325439, 0.37841781421299553, 0.3652693330147297, 0.3517097546070665, 0.3377517154408993, 0.3234104050411501, 0.3087021155549641, 0.2936434338936583, 0.278251241732719, 0.2625427155118044, 0.24653532643474202, 0.23024684046953142, 0.21369531834834118, 0.19689911556751227, 0.1798768823875549, 0.16264756383314993] ;
fi_angl =  [0.15707963267948966, 0.1563806126518595, 0.15428768239150997, 0.15081279220346794, 0.14597590616475936, 0.1398050551892134, 0.13233638293279743, 0.12361579303065028, 0.11369469756686491, 0.10262953701684466, 0.09048292072040137, 0.07732362688175487, 0.06322660256953355, 0.048272963716773865, 0.032549995120920355, 0.01615115044382623, -0.000823947788247209, -0.018269508184630495, -0.036073570490245954, -0.054133154879622246, -0.07234891658214976, -0.09060498792556854, -0.15707963267948966, -0.15649694788995908, -0.15475102635692425, -0.1518481962511795, -0.14779900866870488, -0.14261824394132444, -0.13632611806850528, -0.12894738369290118, -0.12050814763902347, -0.1110380779604135, -0.10057044187800468, -0.08914210578012288, -0.07679353522248619, -0.06356879492820498, -0.049515548787781985, -0.034685059859111675, -0.01913219036748179, -0.002915401705571169, 0.013903245566547956, 0.03125809172141186, 0.04907999136309367, 0.06730786311950797, 0.08587778465279589, 0.10471887901911532, 0.12375996383804326, 0.1429295512925765, 0.1621558481291325, 0.18136675565754848, 0.15707963267948966, 0.1567045762225582, 0.15558009807810538, 0.15370825785678982, 0.1510924854294062, 0.1477375819772929, 0.14364994261544445, 0.1388386225139739, 0.13331248428187428, 0.12708125881222734, 0.12015587975982642, 0.11254848354117683, 0.10427240933449657, 0.09534219907971475, 0.08577359747847349, 0.07558355199412593, 0.06479021285173832, 0.05341293303808785, 0.0414722683016648, 0.028989977152670723, 0.01598902086301915, 0.002493563466336529, -0.011471028242039855, -0.02587818470505937, -0.04070013360396085, -0.055907899858269466, -0.0714717231075193, -0.08736603797069117, -0.10356302753829902, -0.12003336125822367, -0.13674738434452802, -0.15367511777746, -0.17078625830344912, -0.18805017843511004, -0.20543592645123893, -0.22291222639681715, -0.24044747808300754, -0.2580097570871577, -0.27556681475279843] ;
interraotion_t =  [1.9781896238758663, 2.0390159913114636, 2.0998423587470607, 2.1606687261826583, 2.2214950936182554, 2.282321461053853, 2.34314782848945, 2.4039741959250476, 2.4648005633606447, 2.5256269307962422, 2.5864532982318393, 2.647279665667437, 2.708106033103034, 2.768932400538631, 2.8297587679742287, 2.890585135409826, 2.9514115028454233, 3.0122378702810204, 3.073064237716618, 3.1338906051522155, 3.1947169725878126, 3.2555433400234097, 3.313855755793053, 3.3611905461385776, 3.4085253364841024, 3.455860126829627, 3.5031949171751515, 3.5505297075206763, 3.597864497866201, 3.645199288211726, 3.6925340785572507, 3.739868868902775, 3.7872036592483, 3.8345384495938246, 3.8818732399393494, 3.929208030284874, 3.9765428206303985, 4.023877610975924, 4.071212401321448, 4.118547191666973, 4.165881982012498, 4.213216772358022, 4.260551562703547, 4.307886353049072, 4.355221143394596, 4.402555933740121, 4.4498907240856465, 4.497225514431171, 4.544560304776695, 4.59189509512222, 4.6358285510846, 4.669810080871624, 4.703791610658649, 4.737773140445673, 4.771754670232697, 4.805736200019721, 4.839717729806746, 4.87369925959377, 4.9076807893807946, 4.941662319167818, 4.975643848954842, 5.009625378741867, 5.043606908528891, 5.0775884383159156, 5.111569968102939, 5.145551497889964, 5.179533027676988, 5.213514557464013, 5.247496087251037, 5.28147761703806, 5.315459146825085, 5.349440676612109, 5.383422206399134, 5.417403736186158, 5.451385265973182, 5.485366795760206, 5.519348325547231, 5.553329855334255, 5.587311385121279, 5.621292914908303, 5.655274444695327, 5.689255974482352, 5.723237504269376, 5.7572190340564005, 5.791200563843424, 5.825182093630449, 5.859163623417473, 5.893145153204497, 5.9271266829915215] ;
hit_t =  [0.5703421347132581, 1.9781896238758663, 3.313855755793053, 4.6358285510846, 5.959408695090734, 7.292763991400326] ;

%переводим углы в абсолютное измерение от вертикали
ang1 = -Tetta_angl-gamma;
ang2 = fi_angl + Tetta_angl - gamma;

file_size = size(interraotion_t);

X_st = zeros(file_size);
Y_st = zeros(file_size);

X_m = zeros(file_size);
Y_m = zeros(file_size);

X_sw = zeros(file_size);
Y_sw = zeros(file_size);

%первый момент
%в моих данных он начинается с переключения

%переносная нога
xsw = 0;
ysw = 0;
X_sw(1) = xsw;
Y_sw(1) = ysw;

% положение бедра
xm = xsw + L*sin(ang1(1));
ym = ysw + L*cos(ang1(1));
X_m(1) = xm;
Y_m(1) = ym;


%Положение стопы опорной ноги
xst = xm + L*sin(ang2(1));
yst = ym - L*cos(ang2(1));
X_st(1) = xst;
Y_st(1) = yst;

counter = 1;
filename = 'Walk_super_cool.gif';
%отрисовка
figure(1)%('Color','w','Renderer','zbuffer')
axis on
grid on
xlim([-2 2])
ylim([-1 2])

strobePlot = 0;  
tracePlot = 0;    

slope = line([-8 4],[-8*tan(2*pi - gamma) 4*tan(2*pi - gamma)]);
set(slope,'Color','k','LineWidth',0.1);
stleg = line([xst xm],[yst ym]);
set(stleg,'Color','r','LineWidth',2);
swleg = line([xm xsw ],[ym ysw ]);
set(swleg,'Color','k','LineWidth',2);
drawnow
%pause(0.01)

frame = getframe(1);
    im = frame2im(frame);
    [imind,cm] = rgb2ind(im,256);
    imwrite(imind,cm,filename,'gif', 'Loopcount',inf);
delete(gca)




flag = 0;
i_start = 2;
%основной цикл анимации и расчета координат
%остановка после 2 переключений
while counter < 3
for i=i_start:length(interraotion_t)
    %проверка момента времени в списке переключений
    if ~isempty(find(hit_t == interraotion_t(i))) && flag==0
        title('произошло переключение')
        flag = 1;
        counter = counter + 1;
        break
    else
        %опорная нога
        X_st(i) = X_st(i-1);
        Y_st(i) = Y_st(i-1);   
    end
    xst = X_st(i);
    yst = Y_st(i);   
    
    %верх бедра
    xm = xst + L*sin(ang1(i));
    ym = yst + L*cos(ang1(i));
    X_m(i) = xm;
    Y_m(i) = ym;
        
    % переносная нога
    xsw = xm - L*sin(ang2(i));
    ysw = ym - L*cos(ang2(i));
    X_sw(i) = xsw;
    Y_sw(i) = ysw;
%отрисовка
figure(1)
axis on
grid on
xlim([-2 2])
ylim([-1 2])

strobePlot = 0;   % Draw stroboscopic plot: 1
tracePlot = 0;    % Trace path of hip and swing foot: 1 or 2

% Draw first position
slope = line([-8 4],[-8*tan(2*pi - gamma) 4*tan(2*pi - gamma)]);
set(slope,'Color','k','LineWidth',0.1);
stleg = line([xst xm],[yst ym]);
set(stleg,'Color','k','LineWidth',2);
swleg = line([xm xsw ],[ym ysw ]);
set(swleg,'Color','r','LineWidth',2);
ffff = 0;
drawnow
%pause(0.01)

frame = getframe(1);
    im = frame2im(frame);
    [imind,cm] = rgb2ind(im,256);
    imwrite(imind,cm,filename,'gif','WriteMode','append');

delete(gca)
flag=0;
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Переключение
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%теперь xsw стала неподвижной
i_start = i;
for i=i_start:length(interraotion_t)
    if i>1
    if ~isempty(find(hit_t == interraotion_t(i))) && flag ==0
        title('произошло переключение')
        flag = 1;
        counter = counter + 1;
        break
    else
        X_sw(i) = X_sw(i-1);
        Y_sw(i) = Y_sw(i-1);   
    end
    %опорная нога неподвижна
    xsw = X_sw(i);
    ysw = Y_sw(i);   
    
    %верх бедра
    xm = xsw + L*sin(ang1(i));
    ym = ysw + L*cos(ang1(i));
    X_m(i) = xm;
    Y_m(i) = ym;
        
    %позиция опорной ноги
    xst = xm + L*sin(ang2(i));
    yst = ym - L*cos(ang2(i));
    X_st(i) = xst;
    Y_st(i) = yst;
    end
%отрисовка
figure(1)
axis on
grid on
xlim([-2 2])
ylim([-1 2])

strobePlot = 0;   
tracePlot = 0;   


slope = line([-8 4],[-8*tan(2*pi - gamma) 4*tan(2*pi - gamma)]);
set(slope,'Color','k','LineWidth',0.1);
stleg = line([xst xm],[yst ym]);
set(stleg,'Color','r','LineWidth',2);
swleg = line([xm xsw ],[ym ysw ]);
set(swleg,'Color','k','LineWidth',2);

drawnow
%pause(0.1)

frame = getframe(1);
    im = frame2im(frame);
    [imind,cm] = rgb2ind(im,256);
    if i == 1
         imwrite(imind,cm,filename,'gif', 'Loopcount',inf);
    else
         imwrite(imind,cm,filename,'gif','WriteMode','append');
    end
delete(gca)

flag = 0;
end
i_start = i;
end
