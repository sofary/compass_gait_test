L = 1;

y0_angel = [5.969026041820607, 5.969025938459552, 5.969013532402472, 5.96774907948639, 5.902329363856115, 5.744054864615822, 5.500528268367304, 4.953706748112628, 4.339137936637629, 3.545100828562396, 2.8480143176916006, 1.846989560394732, 1.1541561542495766, 0.7743082564650197, 0.7743082564650197, 0.7919357441136593, 0.8722165824390187, 1.1971402126769999, 1.2933136474494287, 0.919416252340743, -0.18546439400865466, -1.2552163450876326, -1.7512731872110971, -1.9638255404508111, -2.519905668594967, -3.8490129477694355, -4.138243771018702, -2.9907598608233448, -1.1285247665304163, 0.6178965874377798, 0.6178965874377798, 0.6173601048834472, 0.8056931783963952, 0.8056931783963952, 0.80578977822874, 0.9091583193235633, 1.3563103520857156, 1.430369630872232, 0.8356737015728803, -0.5379846802663566, -1.6913935402359612, -2.2833931442907565, -2.6838906104800255, -3.4744206913084903, -4.184914299582788, -4.2809704892176486, -3.3131774501582996, -1.2672185715054418, 0.4011982781207981, 1.79458027440332, 2.980738740319189, 3.560135514737247, 3.4580146486379664, 3.0753421071878395, 3.0753421071878395, 3.0753421071878395, 3.0753421071878395, 3.0753421071878395, 3.0753421071878395, 3.0753421071878395, 3.0753421071878395, 3.0753421071878395, 3.0753421071878395, 3.0753421071878395, 3.0753421071878395, 3.055198972981296];

y1_angel = [5.759586531581287, 5.7595865507343875, 5.7595888284538725, 5.75979934252816, 5.763728941838195, 5.76327772257571, 5.7874859974687345, 6.0939856918812, 6.820486306145506, 7.86885207744473, 8.435164438084731, 9.032119182935322, 9.893779040616185, 10.863247549680882, 10.863247549680882, 10.877225106841763, 10.789232346211985, 10.442548780466916, 10.086479264395555, 9.727809507985583, 9.30894705462692, 8.965385350092589, 8.737769046502015, 8.706643311199624, 9.014217500399226, 9.486683903741293, 10.088212249011683, 10.515969391676295, 10.692005930344063, 10.622005954679008, 10.622005954679008, 10.728593525408636, 11.06293949456094, 11.06293949456094, 11.045900973560677, 10.879080542169078, 10.450785094413824, 10.008165418048389, 9.586458216594496, 9.145013649983111, 8.786761094912437, 8.518532070520514, 8.578378802618492, 8.9162990078348, 9.272865369441359, 9.733609862591727, 10.280614624988171, 10.748897348636577, 10.968010741841647, 10.969256106301241, 10.786637619733723, 10.411777201077792, 9.931692530638099, 9.37603822207391, 9.37603822207391, 9.37603822207391, 9.37603822207391, 9.37603822207391, 9.37603822207391, 9.37603822207391, 9.37603822207391, 9.37603822207391, 9.37603822207391, 9.37603822207391, 9.37603822207391, 9.355873259572249];

interraotion_t = [0.0, 0.000148689698461654, 0.001635586683078194, 0.016504556529243593, 0.11751211441761582, 0.21136839896421736, 0.29876049336084354, 0.4276361827161761, 0.5250462547631314, 0.6224563268100867, 0.7140145659748087, 0.8770201952366972, 1.0511733333916287, 1.1953777248592006, 1.276476803007488, 1.3118582535654517, 1.4218473975753605, 1.5445930236444254, 1.6354072493639806, 1.7262214750835359, 1.84824040651666, 1.9736401180500605, 2.094594282631697, 2.2525304070511982, 2.4104665314706994, 2.564209369208954, 2.708087018886726, 2.843349252734069, 2.9833928325444288, 3.107734355556167, 3.1675273238710075, 3.2244087515086224, 3.408267396424365, 3.4509201258501516, 3.4627624530145003, 3.5354018380908094, 3.6411494638136412, 3.7328854627237074, 3.8239050484086485, 3.937754667686387, 4.051604286964126, 4.180551132396068, 4.384189835918158, 4.5204314275677735, 4.6171361322675235, 4.709646991090021, 4.821502005280543, 4.945602312277807, 5.060431579217884, 5.1742396089473335, 5.288047638676783, 5.408088144503846, 5.505661829587311, 5.602664441401153, 5.64326298525857, 5.678224999781353, 5.713483751817727, 5.748968014860328, 5.784187482925471, 5.819695837322527, 5.854932075801365, 5.890458279120293, 5.925711988469023, 5.961255972639541, 5.996527181668657, 6.0];

hit_t = [1.276476803007488, 3.1675273238710075, 3.4509201258501516, 5.64326298525857, 5.678224999781353, 5.713483751817727, 5.748968014860328, 5.784187482925471, 5.819695837322527, 5.854932075801365, 5.890458279120293, 5.925711988469023, 5.961255972639541, 5.996527181668657];


fi_angl = y0_angel - y1_angel;

alpha = pi/12;

X_st = zeros(size(y0_angel));
Y_st = zeros(size(y0_angel));

X_m = zeros(size(y0_angel));
Y_m = zeros(size(y0_angel));

X_sw = zeros(size(y0_angel));
Y_sw = zeros(size(y0_angel));

%первый кадр
xst = 0;
yst = 0;

angel_0 = 2*pi - pi/10;%y0_angel(1)
angel_1 = 2*pi - pi/6;%y1_angel(1)

% Position of hip
xm = xst+L*sin(2*pi - angel_0);
ym = yst+L*cos(2*pi - angel_0);
X_m(1) = xm;
Y_m(1) = ym;


% Position of swing foot
xsw = xm - L*sin(2*pi - angel_1);
ysw = ym - L*cos(2*pi - angel_1);

X_sw(1) = xsw;
Y_sw(1) = ysw;


filename = 'Walk_cool.gif';
%смотрим номер переключения
flag = 0;

for i=1:30%length(y1_angel)
    figure(1)%('Color','w','Renderer','zbuffer')
    if i>1
    if ~isempty(find(hit_t == interraotion_t(i)))
        %координата опорной ноги
        title('произошло переключение')
        flag = flag + 1;
        X_st(i) = X_sw(i-1);
        Y_st(i) = Y_st(i-1) ;         
    else
        X_st(i) = X_st(i-1);
        Y_st(i) = X_st(i-1) ; 
    end
    xst = X_st(i);
    yst = Y_st(i);   
    
    if mod(flag,2)==0
        
    end
    %верх бедра
    xm = xst+L*sin(2*pi - y0_angel(i));
    ym = yst+L*cos(2*pi - y0_angel(i));
    X_m(i) = xm;
    Y_m(i) = ym;
        
    % Position of swing foot
    xsw = xm - L*sin(2*pi - y1_angel(1));
    ysw = ym - L*cos(2*pi - y1_angel(1));
    X_sw(i) = xsw;
    Y_sw(i) = ysw;
    end

%axis([xsw 10.55 -1 1.5*L])
axis on
xlim([-8 4])
ylim([-3 2])

strobePlot = 0;   % Draw stroboscopic plot: 1
tracePlot = 0;    % Trace path of hip and swing foot: 1 or 2

% Draw first position
slope = line([-8 4],[-8*tan(2*pi - alpha) 4*tan(2*pi - alpha)]);
set(slope,'Color','k','LineWidth',0.1);
stleg = line([xst xm],[yst ym]);
set(stleg,'Color','k','LineWidth',2);
swleg = line([xm xsw ],[ym ysw ]);
set(swleg,'Color','b','LineWidth',2);

drawnow
pause(0.4)

frame = getframe(1);
    im = frame2im(frame);
    [imind,cm] = rgb2ind(im,256);
    if i == 1
         imwrite(imind,cm,filename,'gif', 'Loopcount',inf);
    else
         imwrite(imind,cm,filename,'gif','WriteMode','append');
    end
    %scalebarpsn('location','sw'); hold on;
delete(gca)
end